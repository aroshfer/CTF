# Trusted Uploads — File Upload CTF (Harder)

**Category:** Web — File Upload Exploit  
**Difficulty:** Medium→Hard (chain required)  
**Points:** 18

## Description
A staff portal accepts profile pictures and aggressively validates uploads:
- Extension allowlist (`.png`, `.jpg`, `.jpeg`, `.gif`)
- Magic-bytes check using `file-type`
- Naive content scanning for suspicious strings
- Server re-encodes images with `sharp` to `.webp`
- Legacy admin conversion endpoint runs `cwebp` using a shell exec (intentionally insecure)

The goal is to chain a bypass to get the server to divulge `flag.txt` (placed in server root). The server is intentionally flawed for educational CTF purposes — run it only in a safe, isolated environment.

## How to run (local)
1. `npm install`
2. `node server.js`
3. Visit `http://localhost:3000/` to use the upload page.
4. Admin conversion endpoint (for testing): `POST /admin/convert` with `application/x-www-form-urlencoded` body: `file=<filename>`.

## Docker (recommended for CTF hosting)
- Build: `docker build -t trusted-uploads .`
- Run: `docker run -p 3000:3000 --rm trusted-uploads`

## Files in repo
- `server.js` — vulnerable CTF server
- `public/` — web client and admin UI
- `uploads/` — upload storage (created on runtime)
- `flag.txt` — challenge flag (placed server-side)
- `notes/` — optional hints & tests
- `Dockerfile`, `docker-compose.yml` — optional deployment helpers

## Hints (non-spoiler)
See `notes/hints.md` for progressive hints.

## Legal / Safety
This is an intentionally vulnerable application for teaching and CTF use. Do **not** deploy it on public networks without isolation. Only use in controlled environments.
